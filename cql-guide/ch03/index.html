<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Chapter 3: Expressions, Literals, Nullability, Sensitivity | CG/SQL</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Chapter 3: Expressions, Literals, Nullability, Sensitivity | CG/SQL"><meta data-react-helmet="true" name="description" content="&lt;!---"><meta data-react-helmet="true" property="og:description" content="&lt;!---"><meta data-react-helmet="true" property="og:url" content="https://cgsql.dev/cql-guide/ch03"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cgsql.dev/cql-guide/ch03"><link rel="stylesheet" href="/styles.45b22519.css">
<link rel="preload" href="/styles.480d1f30.js" as="script">
<link rel="preload" href="/runtime~main.34082030.js" as="script">
<link rel="preload" href="/main.b815b31d.js" as="script">
<link rel="preload" href="/1.2e95473d.js" as="script">
<link rel="preload" href="/2.0c45b020.js" as="script">
<link rel="preload" href="/3.d04889a6.js" as="script">
<link rel="preload" href="/1be78505.d00e88e1.js" as="script">
<link rel="preload" href="/82.ac17f5fe.js" as="script">
<link rel="preload" href="/5456faf3.a2899e62.js" as="script">
<link rel="preload" href="/17896441.ea9e5e3f.js" as="script">
<link rel="preload" href="/8982177e.8b72bbe3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/cql-guide/ch01">CQL Guide</a><a class="navbar__item navbar__link" href="/program-diagram">Railroad Diagram</a><a class="navbar__item navbar__link" href="/json-diagram">Railroad Diagram: JSON</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/cql-guide/ch01">CQL Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/program-diagram">Railroad Diagram</a></li><li class="menu__list-item"><a class="menu__link" href="/json-diagram">Railroad Diagram: JSON</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">CQL Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch01">Chapter 1: Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch02">Chapter 2: Using Data</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/cql-guide/ch03">Chapter 3: Expressions, Literals, Nullability, Sensitivity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch04">Chapter 4: Procedures, Functions, and Control Flow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch05">Chapter 5: Types of Cursors, OUT and OUT UNION, and FETCH flavors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch06">Chapter 6: Calling Procedures Defined Elsewhere</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch07">Chapter 7: CQL Result Sets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch08">Chapter 8: Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch09">Chapter 9: Statements Summary and Error Checking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch10">Chapter 10: Schema Management Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch11">Chapter 11: Previous Schema Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch12">Chapter 12: Testability Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch13">Chapter 13: JSON Output</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/ch14">Chapter 14: CQL Query Fragments</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x1">Appendix 1: Command Line Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x2">Appendix 2: CQL Grammar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x3">Appendix 3: Control Directives</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x4">Appendix 4: CQL Error Codes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x5">Appendix 5: JSON Schema Grammar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x6">Appendix 6: CQL In 20 Minutes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x7">Appendix 7: CQL Anti-patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x8">Appendix 8: CQL Best Practices</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Chapter 3: Expressions, Literals, Nullability, Sensitivity</h1></header><div class="markdown"><p>Until this point we&#x27;ve only discussed simple kinds of expressions and as well as variables and table columns marked with <code>NOT NULL</code> . These are indeed the easiest types for CQL to work with as they tend to correspond most directly to the types known to C.  However
SQL provides for many more types of expressions as well as nullable types and these require handling in any language that purports to be like SQL.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="expression-examples"></a>Expression Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#expression-examples" title="Direct link to heading">#</a></h3><p>The usual arithmetic operators apply in CQL:</p><p>Example expressions (these are all true)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(1 + 2) * 3 == 9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1 + 2 * 3 == 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6 / 3 == 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7 - 5 == 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6 % 5 == 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5 / 2.5 == 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7 &amp; 3 == 2 | 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1 &lt;&lt; 2 == 4</span></div></div></div></div></div><p>However, before going any further it&#x27;s important to note that CQL is inherently a two-headed beast.  Expressions are either evaluated by transpiling to C (like the predicate of an IF statement, or a variable assignment) or by sending them to SQLIte for evaluation (like expressions inside a <code>SELECT</code> statement or the <code>WHERE</code> part of a <code>DELETE</code>).</p><p>CQL evaluation rules are designed to be as similar as possible but some variance is inevitable because evaluation is done in two fundamentally different ways.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="order-of-evaluation"></a>Order of Evaluation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#order-of-evaluation" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ASSIGNMENT:    :=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_OR:    OR</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_AND:   AND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EQUALITY:      = == != &lt;&gt; IS, IS NOT, IN, NOT IN, LIKE, GLOB, MATCH, REGEXP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INEQUALITY:    &lt;   &lt;=  &gt;   &gt;=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_NOT:   NOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BINARY:        &lt;&lt; &gt;&gt; &amp; |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BETWEEN:       BETWEEN  NOT BETWEEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ADDITION:      + -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MULIPLICATION: * / %</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BINARY_NOT:    ~</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CONCAT:        ||</span></div></div></div></div></div><p>NOTE: the above is NOT the C binding order (!!!)  The Sqlite binding order is used in the language and parens are added in the C output as needed to force that order.   CQL&#x27;s rewriting emits minimal parens in all outputs.  Different parens are often needed for SQL output.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="variables-columns-basic-types-and-nullability"></a>Variables, Columns, Basic Types and Nullability<a aria-hidden="true" tabindex="-1" class="hash-link" href="#variables-columns-basic-types-and-nullability" title="Direct link to heading">#</a></h3><p>CQL needs type information for both variables in the code and columns in the database.
Like SQL, CQL allows variables to hold a NULL value and just as in SQL the absence
of <code>NOT NULL</code> implies that <code>NULL</code> is a legal value. Consider these examples:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- real code should use better names than this :)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> all_the_nullables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  i1 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b1 </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  l1 long</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  r1 </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  t1 </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bl1 </span><span class="token keyword" style="font-style:italic">blob</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> b2 </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> l2 long</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> r2 </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t2 </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> bl2 </span><span class="token keyword" style="font-style:italic">blob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>ALL of <code>i1</code>, <code>i2</code>, <code>b1</code>, <code>b2</code>, <code>l1</code>, <code>l2</code>, <code>r1</code>, <code>r2</code>, <code>t1</code>, <code>t2</code>, and <code>bl1</code>, <code>bl2</code> are nullable.
In some sense variables and columns declared nullable (by virtue of the missing <code>NOT NULL</code>) are the
root sources of nullability in the SQL language.  That and the <code>NULL</code> literal.  Though there are other
sources as we will see.</p><p><code>NOT NULL</code> could be added to any of these, e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- real code should use better names than this :)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i_nn </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In the context of computing the types of expressions, CQL is statically typed and so it must make a decision about the type of any expression based on the type information at hand at compile time.  As a result it handles the static type of an expression conservatively.  If the result might be null then the expression is of a nullable type and the compiled code will include an affordance for the possibility of a null value at runtime.</p><p>The generated code for nullable types is considerably less efficient and so it should be avoided if that is reasonably possible.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="let-statement"></a>LET Statement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#let-statement" title="Direct link to heading">#</a></h4><p>You can declare and initialize a variable in one step using the <code>LET</code> form, e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The named variable is declared to be the exact type of the expression on the right.  More on expressions in the coming sections.  The right side is often a constant
in these cases but does not need to be.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- integer not null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET l :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- long not null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- text not null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET b :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- bool not null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET b :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- bool (maybe not null depending on x/y)</span></div></div></div></div></div><p>The psuedo function &quot;nullable&quot; removes <code>not null</code> from the type of its argument but otherwise does no computation.
This can be useful to initialize nullable types.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET n_i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nullable integer variable initialized to 1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET n_l :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nullable long variable initialized to 1</span></div></div></div></div></div><p>The psuedo function &quot;sensitive&quot; adds <code>@sensitive</code> to the type of its argument but otherwise does no computation.
This also can be useful to initialize nullable types.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET s_i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive nullable integer variable initialized to 1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET s_l :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive nullable long variable initialized to 1</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-rc-special-variable"></a>The <code>@RC</code> special variable<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-rc-special-variable" title="Direct link to heading">#</a></h4><p>CQL also has the special built-in variable <code>@RC</code> which refers to the most recent error code returned by a SQLite operation, e.g. 0 == <code>SQLITE_OK</code>, 1 == <code>SQLITE_ERROR</code>.   <code>@RC</code> is of type <code>integer not null</code>.  Specifically:</p><ul><li>each catch block captures the error code when it is entered into its own local variable</li><li>this variable is created lazily, so it only exists if it is used<ul><li>the variable is called <code>_rc_thrown_n</code> where n is the catch block number in the procedure</li></ul></li><li>any reference to <code>@RC</code> refers to the above error variable of the innermost catch block the <code>@RC</code> reference is in</li><li>if the <code>@RC</code> reference happens outside of any catch block its value is <code>SQLITE_OK</code> (i.e. zero).</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="types-of-literals"></a>Types of Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#types-of-literals" title="Direct link to heading">#</a></h3><p>There are a number of literal objects that may be expressed in CQL.  These are as follows:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="string-literals"></a>String Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#string-literals" title="Direct link to heading">#</a></h4><ul><li>A double quoted string is a C style string literal<ul><li>the usual simple C escape sequences are supported</li><li>the \xNN form for embedded hex characters is supported, however</li><li>the \0NNN octal form is not supported, and</li><li>embedded nulls in string literals (\0 or \0x00) are not supported (you must use blobs in such cases)</li></ul></li><li>a single quoted string is a SQL style string literal<ul><li>No escape sequences are supported other than <code>&#x27;&#x27;</code> to indicate a single quote character (this is just like normal SQLite)</li></ul></li><li>The sequence @FILE(&quot;some_string&quot;) is a special string literal<ul><li>the value of this literal is the path of the current compiland starting at the letters in <code>some_string</code>, or</li><li>the entire path of the current compiland if <code>some_string</code> does not occur in the path</li><li>the purpose of the <code>@FILE</code> construct is to provide a partial path to a file for diagnostics that is consistent even if the file is built in various different root paths on different build machines</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="blob-literals"></a>Blob Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#blob-literals" title="Direct link to heading">#</a></h4><ul><li>SQLite Blob literals are supported in SQL contexts (i.e. where they will be processed by SQLite), CQL produces an error if you attempt to use a blob literal in a loose expression</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="numeric-literals"></a>Numeric Literals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#numeric-literals" title="Direct link to heading">#</a></h4><ul><li>All numeric literals are considered to be positive; negative numbers are actually a positive literal combined with unary minus (the negation operator)</li><li>Base 10 and hexadecimal literals are supported</li><li>Literals with a decimal point are of type <code>REAL</code> and stored as the C type <code>double</code></li><li>Literals that can fit in a signed integer without loss, and do not end in the letter <code>L</code> are integer literals</li><li>Larger literals, or those ending with the letter <code>L</code> are long integer literals.</li><li>Literals that begin with 0x are interpreted as hex</li></ul><p>Examples:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  1.3            -- real</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  2L             -- long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  123456789123   -- long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  123            -- integer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  0x10           -- hex integer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  0x10L          -- hex long integer</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-null-literal"></a>The NULL literal<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-null-literal" title="Direct link to heading">#</a></h4><p>The use of <code>NULL</code> always gives a nullable result however this literal is special in that it has no storage class. <code>NULL</code> is not numeric, or string but rather mutates into
whatever it is first combined with.   For instance <code>NULL + 1</code> results in a nullable integer.  Because <code>NULL</code> has no primitive type in some cases where type knowledge
is required you might have to use the CAST() function to cast the NULL to a specific type such as <code>CAST(NULL as TEXT)</code>.   This construct guarantees type consistence in cases like <code>SELECT</code> from different sources combined with <code>UNION ALL</code></p><p>Note:  constructs like <code>CAST(NULL as TEXT)</code> are always rewritten to just <code>NULL</code> before going to SQLite as the cast is uninteresting except for the type information which SQLite doesn&#x27;t need/use anyway.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="other-considerations"></a>Other Considerations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#other-considerations" title="Direct link to heading">#</a></h4><p>There are no boolean literals other than the integers <code>0</code> and <code>1</code>.</p><p>The C pre-processor is often combined with CQL in which case the <code>_FILE_</code> and <code>_LINE_</code> directives may be used to create literals; they will be preprocessed into normal literals.</p><p>The use of <code>_FILE_</code> can give surprising results in the presence of build systems, hence the existence of <code>@FILE(...)</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="const-and-enumerations"></a>Const and Enumerations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#const-and-enumerations" title="Direct link to heading">#</a></h3><p>It&#x27;s possible to use named constants in CQL with nothing more than the C pre-processor features that have already appeared,
however use of #define in such a way is not entirely satisfactory.  For one thing, CQL will not know these constants
exist in any way as they will be replaced before it ever sees them.  This means CQL can&#x27;t provide their values for you
in the JSON output for instance.</p><p>To help with this problem, CQL includes constants, note, this is not the same as enumerated types as we&#x27;ll
see later.  You can now write something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum business_type integer (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  restuarant,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  laundromat,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  corner_store = 11+3  /* math added for demo purposes only */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>After this enum is declared, this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select business_type.corner_store;</span></div></div></div></div></div><p>is the same as this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">select 14;</span></div></div></div></div></div><p>And that is exactly what SQLite will see, the literal <code>14</code>.</p><p>You can also use the enum to define column types:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE TABLE businesses (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name  TEXT,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type  business_type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>CQL will then enforce you use the correct enum to access those columns. For example, this is valid:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT * FROM businesses WHERE type = business_type.laundromat;</span></div></div></div></div></div><p>While this does not type check:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT * FROM businesses WHERE type = business_corp_state.delaware;</span></div></div></div></div></div><p>Enumerations follow these rules:</p><ul><li>the enumeration can be any numeric type (bool, integer, long integer, real)</li><li>the values of the enumeration start at 1 (i.e. if there is no <code>= expression</code> the first item will be <code>1</code>, not <code>0</code>)</li><li>if you don&#x27;t specify a value, the next value is the previous value plus one</li><li>if you do specify a value it can be any constant expression and it will be cast to the type of the enumeration (even if that is lossy)</li><li>the enumeration can refer to previous values in itself with no qualification <code>(big = 100.0, medium = big/2, small = medium/2)</code></li><li>the enumeration can refer to previously defined enumerations as usual <code>(code = business_type.restaurant)</code></li><li>Once the enumeration is defined you refer to its members in a fully qualified fashion <code>enum_name.member_name</code> elsewhere</li></ul><p>With these forms you get some additional useful output:</p><ul><li>the JSON includes the enumerations and their values in their own section</li><li>you can use the <code>@emit_enums</code> directive to put declarations like this into the <code>.h</code> file that corresponds to the current compiland</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">enum business_type {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  business_type__restaurant = 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  business_type__laundromat = 2,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  business_type__corner_store = 14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div></div></div><p>Note that C does not allow for floating point enumertions, so in case of floating point values such as:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum floating real (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  one = 1.0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  two = 2.0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  e = 2.71828,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  pi = 3.14159</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>You get:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// enum floating (floating point values)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define floating__one 1.000000e+00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define floating__two 2.000000e+00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define floating__e 2.718280e+00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define floating__pi 3.141590e+00</span></div></div></div></div></div><p>In order to get useful expressions in enumeration values, constant folding and general evaluation was added to the compiler;
these expressions work on any numeric type and the literal null.  The supported operations include:</p><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, <code>|</code>, <code>&amp;</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>~</code>, <code>and</code>, <code>or</code>, <code>not</code>, <code>==</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, the <code>cast</code> operator
and the <code>case</code> forms (including the <code>iif</code> function).  These are enough to make a lot of very interesting expressions, all of
which are evaluated at compile time.</p><p>Constant folding was added to allow for rich <code>enum</code> expressions, but there is also the <code>const()</code> primitive in the
language which can appear anywhere a literal could appear.  This allows you do things like:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table something(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  x integer default const((1&lt;&lt;16)|0xf) /*  again the math is just for illustration */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>The <code>const</code> form is also very useful in macros:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#define SOMETHING const(12+3)</span></div></div></div></div></div><p>This form ensures that the constant will be evaluated at compile time. The <code>const</code> psuedo-function can also also nest
so you can build these kinds of macros from other macros or you can build enum values this way.
Anywhere you might need literals, you can use <code>const</code>.</p><p>Importantly, no enumerated data types were added to the language to do any of this.  The following
is an error:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum my_enum integer (a, b);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare x my_enum;    /* my_enum is not a valid type: use integer, real, etc. */</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="named-types"></a>Named Types<a aria-hidden="true" tabindex="-1" class="hash-link" href="#named-types" title="Direct link to heading">#</a></h3><p>A common source of errors in stored procedures is incorrect typing in arguments.  For instance, a particular key
for an entity might need to be <code>LONG</code> or even always <code>LONG NOT NULL</code> or <code>LONG NOT NULL @SENSITIVE</code> and the only
way to do this in the past was maybe with some <code>#define</code> thing.  Otherwise you have to diligently get the type right
in all the places, and should it ever change, again you have to visit all the places.   To help with this situation,
and to make code a little more self-describing we add named types to the language.  This is a lot like <code>typedef</code> in
the C language.  They do not create different incompatible types but do let you name things well.</p><p>You can now write these sorts of forms:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare foo_id type long not null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create table foo(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id foo_id primary key autoincrement,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">create proc inserter(name_ text, out id foo_id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  insert into foo(id, name) values(NULL, name_);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  set id := last_insert_rowid();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare function func_return_foo_id() foo_id;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare var foo_id;</span></div></div></div></div></div><p>Additionally any enumerated type can be used as a type name.  e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum thing integer (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  thing1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  thing2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare thing_type type thing;</span></div></div></div></div></div><p>Enumerations always get &quot;not null&quot; in addition to their base type.  Enumerations also have a unique &quot;kind&quot; associated,
specfically the above enum has type <code>integer&lt;thing&gt; not null</code>.  The rules for type kind are described below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="type-kinds"></a>Type Kinds<a aria-hidden="true" tabindex="-1" class="hash-link" href="#type-kinds" title="Direct link to heading">#</a></h3><p>Any CQL type can be tagged with a &quot;kind&quot; for instance <code>real</code> can become <code>real&lt;meters&gt;</code>, <code>integer</code> can become <code>integer&lt;job_id&gt;</code>.  The idea here is that the additional tag, the &quot;kind&quot; can help prevent type mistakes
in arguments and in columns and procedure calls.  For instance:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> things</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  size </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">meters</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  duration </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">seconds</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> do_something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_ </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">meters</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> duration_ </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">seconds</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> things</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> duration_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In this situation you couldn&#x27;t accidentally switch the columns in <code>do_something</code> even though both
are <code>real</code>, and indeed SQLite will only see the type <code>real</code> for both.  If you have your own variables
typed <code>real&lt;size&gt;</code> and <code>read&lt;duration&gt;</code> you can&#x27;t accidentally do:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> do_something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Even though both are real.  The type kind won&#x27;t match.</p><p>Importantly, an expression with no type kind is compatible with any type kind (or none).  Hence all of
the below are legal.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> generic </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> generic :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no kind may accept &lt;meters&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> generic :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no kind may accept &lt;seconds&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> duration :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> generic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no kind may be stored in &lt;seconds&gt;</span></div></div></div></div></div><p>Only mixing types where both have a kind, and the kind is different generates errors.  This choice allows you to
write procedures that (for instance) log any <code>integer</code> or any <code>real</code>, or that return an <code>integer</code> out of a collection
or some such.</p><p>These rules are applied to comparisons, assignments, column updates, everywhere types are checked for compatibility.</p><p>To get the most value out of these constructs, the authors recommend that type kinds be used universally except
when the extra compatibility described above is needed (like low level helper functions).</p><p>Importantly type kind can be applied to object types as well, allowing <code>object&lt;dict&gt;</code> to be distinct from <code>object&lt;list&gt;</code>.</p><p>At run time the kind information is lost. But it does find its way into the JSON output so external tools
also get to see the kinds.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nullability"></a>Nullability<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nullability" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nullability-rules"></a>Nullability Rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nullability-rules" title="Direct link to heading">#</a></h4><p>Nullability is tracked via CQL&#x27;s type system. To understand whether or not an
expression will be assigned a nullable type, you can follow these rules; they
will hopefully be intuitive if you are familiar with SQL:</p><ul><li><p>The literal <code>NULL</code> is, of course, always assigned a nullable type. All other
literals are nonnull.</p></li><li><p>In general, the type of an expression involving an operator (e.g., <code>+</code>, <code>==</code>,
<code>!=</code>, <code>~</code>, <code>LIKE</code>, et cetera) is nullable if any of its arguments are
nullable. For example, <code>1 + NULL</code> is assigned the type <code>INTEGER</code>, implying
nullability. <code>1 + 2</code>, however, is assigned the type <code>INTEGER NOT NULL</code>.</p></li><li><p><code>IN</code> and <code>NOT IN</code> expressions are assigned a nullable type if and only if
their left argument is nullable: The nullability of the right side is
irrelevant. For example, <code>&quot;foo&quot; IN (a, b)</code> will always have the type <code>BOOL NOT
NULL</code>, whereas <code>some_nullable IN (a, b)</code> will have the type <code>BOOL</code>.</p><ul><li><strong>NOTE:</strong> In CQL, the <code>IN</code> operator behaves like a series of equality tests
(i.e., <code>==</code> tests, not <code>IS</code> tests), and <code>NOT IN</code> behaves symmetrically.
SQLite has slightly different nullability rules for <code>IN</code> and <code>NOT IN</code>. <em>This
is the one place where CQL has different evaluation rules from SQLite, by
design.</em></li></ul></li><li><p>The result of <code>IS</code> and <code>IS NOT</code> is always of type <code>BOOL NOT NULL</code>, regardless
of the nullability of either argument.</p></li><li><p>For <code>CASE</code> expressions, the result is always of a nullable type if no <code>ELSE</code>
clause is given. If an <code>ELSE</code> is given, the result is nullable if any of the
<code>THEN</code> or <code>ELSE</code> expressions are nullable.</p><ul><li><strong>NOTE:</strong> The SQL <code>CASE</code> construct is quite powerful: Unlike the C <code>switch</code>
statement, it is actually an expression. In this sense, it is rather more
like a highly generalized ternary <code>a ? b : c</code> operator than a C switch
statement. There can be arbitrarily many conditions specified, each with
their own result, and the conditions need not be constants; typically, they
are not.</li></ul></li><li><p><code>IFNULL</code> and <code>COALESCE</code> are assigned a <code>NOT NULL</code> type if one or more of their
arguments are of a <code>NOT NULL</code> type.</p></li><li><p>In most join operations, the nullability of each column participating in the
join is preserved. However, in a <code>LEFT OUTER</code> join, the columns on the right
side of the join are always considered nullable; in a <code>RIGHT OUTER</code> join, the
columns on the left side of the join are considered nullable.</p></li><li><p>As in most other languages, CQL does not perform evaluation of value-level
expressions during type checking. There is one exception to this rule: An
expression within a <code>const</code> is evaluated at compilation time, and if its
result is then known to be nonnull, it will be given a <code>NOT NULL</code> type. For
example, <code>const(NULL or 1)</code> is given the type <code>BOOL NOT NULL</code>, whereas merely
<code>NULL or 1</code> has the type <code>BOOL</code>.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nullability-improvements"></a>Nullability Improvements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nullability-improvements" title="Direct link to heading">#</a></h4><p><strong>NOTE:</strong> This is a new feature of CQL that currently <strong>disabled by default</strong>. Until
it becomes the default in a future version of CQL, you will need to use
<code>@enforce_strict not null after check;</code> to gain access to this functionality.</p><p>CQL is able to &quot;improve&quot; the type of some expressions from a nullable type to a
<code>NOT NULL</code> type via occurrence typing, also known as flow typing. As in other
languages (e.g., Racket, where occurrence typing originated, and more recently
Kotlin, TypeScript, et cetera), it is possible to use a conditional to refine a
type.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="improvements-in-if-and-case"></a>Improvements in <code>IF</code> and <code>CASE</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#improvements-in-if-and-case" title="Direct link to heading">#</a></h5><p>One way to improve a type to be <code>NOT NULL</code> is by using an <code>IS NOT NULL</code> check
within an <code>IF â€¦Â THEN â€¦Â END IF</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_proc_with_an_out_arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` has type `INT NOT NULL` here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` reverts to type `INT` here</span></div></div></div></div></div><p>Above, you can see how the check in <code>IF x IS NOT NULL</code> allows <code>x</code> to be of type
<code>INT NOT NULL</code> within the body of the <code>THEN</code>.</p><p>The same applies to <code>WHEN</code> clauses within a <code>CASE</code> expression:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_proc_with_an_out_arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LET y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `y` has type `INT NOT NULL` here</span></div></div></div></div></div><p>Cursor fields are also eligible identifiers for improvement:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> t </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `c.x` has type `INT NOT NULL` here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>For some identifier <code>x</code> to be improved via some conditional expression, it must
be along the outermost spine of <code>AND</code>-separated expressions, and it must be
exactly of the form <code>x IS NOT NULL</code>. For example, this will work for both <code>x1</code>
and <code>x2</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x1 </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> x2 </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x1` and `x2` are nonnull here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Neither, however, will be improved here:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x1 </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x2 </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> x1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x1` and `x2` are nullable here because the checks</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- involving `IS NOT NULL` appear within an `OR`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p><strong>NOTE:</strong> CQL currently only improves some identifier <code>x</code> if the check is
<em>exactly</em> of the form <code>x IS NOT NULL</code>: Other expressions that are only true if
<code>x</code> is not <code>NULL</code>, such as <code>x &gt; 100</code>, cause no such improvement to occur.
Additionally, no improvement will occur if <code>x</code> is a global: Only local variables
are eligible. Both of these restrictions may be lifted in a future version of
CQL.</p><p>The nullability improvement for a given identifier persists up until a <code>SET</code>,
<code>FETCH</code>, or use in an <code>OUT</code> position that involves the improved variable. For
example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is nonnull here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is nullable here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is once again NOT NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is again nullable</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is nonnull here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_proc_with_an_out_arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is nullable</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>As a special case, <code>SET</code> does not remove an improvement for a given identifier
if the right side of the <code>SET</code> is of a <code>NOT NULL</code> type. On the contrary, <code>SET</code>
will <em>improve</em> the type of the identifier on the left-hand side in such
situations. For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> a </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` now has type `INT NOT NULL`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` reverts to type `INT`</span></div></div></div></div></div><p>Improvements via <code>SET</code>â€”and, indeed, all nullability improvementsâ€”respect the
control flow of the program. If an improvement is made via <code>SET</code> within the body
of a <code>THEN</code>, for example, it will not be present in the <code>ELSE</code>, nor will it be
present after the end of the <code>IF â€¦ THEN â€¦ ELSE â€¦Â END IF</code> block.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="improvements-in-select-expressions"></a>Improvements in Select Expressions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#improvements-in-select-expressions" title="Direct link to heading">#</a></h5><p>CQL can also improve the type of an identifier in a <code>SELECT</code> expression via <code>IS
NOT NULL</code> checks in a <code>WHERE</code> clause. These improvements apply both in the
select expressions themselves and in the resulting columns. Let&#x27;s look at the
following example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> t </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- both `c.a` and `c.b` have type `INT NOT NULL` here</span></div></div></div></div></div><p>Above, <code>c.a</code> has type <code>INT NOT NULL</code> because <code>x</code> was established to be nonnull,
thus so too was <code>x + x</code>. In addition, <code>c.b</code> has type <code>INT NOT NULL</code> because the
resulting column <code>b</code> was established to be <code>NOT NULL</code> directly.</p><p><strong>NOTE:</strong> CQL is currently unable to improve a type via an <code>IS NOT NULL</code>
expression appearing in an <code>ON</code> or <code>HAVING</code> clause. This restriction may be
lifted in a future version of CQL.</p><p><strong>NOTE:</strong> CQL is not yet able to take details of JOINs into account. For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> both_results_columns_are_again_nonnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> t </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> u </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> u</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Both resulting columns in the above example have type <code>INT NOT NULL</code>: <code>a</code>,
because <code>t.x IS NOT NULL</code>, and <code>b</code>, because <code>b IS NOT NULL</code>. However, if one
were to have specified <code>u.x IS NOT NULL</code> instead of <code>t.x IS NOT NULL</code>, <code>a</code> would
<em>not</em> have been given a nonnull type even though it arguably should have been.
This can be worked around easily, yet it remains a minor deficiency of CQL for
the time being.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="forcing-nonnull-types"></a>Forcing Nonnull Types<a aria-hidden="true" tabindex="-1" class="hash-link" href="#forcing-nonnull-types" title="Direct link to heading">#</a></h4><p>If possible, it is best to use the techniques described in &quot;Nullability
Improvements&quot; to verify that value of a nullable type is nonnull before using it
as such.</p><p>Sometimes, however, you may know that a value with a nullable type cannot be
null and simply wish to use it as though it were nonnull.  The <code>ifnull_crash</code>
and <code>ifnull_throw</code> &quot;attesting&quot; functions convert the type of an expression to be
nonnull and ensure that the value is nonnull with a runtime check.  They cannot
be used in SQLite contexts because the functions are not known to SQLite, but
they can be used in loose expressions. For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> square_if_odd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` has type `INT`, but we know it can&#x27;t be `NULL`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> square_if_odd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `y` has type `INT NOT NULL`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ifnull_crash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Above, the <code>ifnull_crash</code> attesting function is used to coerce the expression
<code>x</code> to be of type <code>INT NOT NULL</code>. If our assumptions were somehow wrong,
howeverâ€”and <code>x</code> were, in fact, <code>NULL</code>â€”our program would crash.</p><p>As an alternative to crashing, you can use <code>ifnull_throw</code>. The following two
pieces of code are equivalent:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> y_is_not_null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  let y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ifnull_throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> y_is_not_null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    THROW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="expression-types"></a>Expression Types<a aria-hidden="true" tabindex="-1" class="hash-link" href="#expression-types" title="Direct link to heading">#</a></h3><p>CQL supports a variety of expressions, nearly everything from the SQLite world.  The following are the various supported operators, they are presented in order from the weakest binding strength to the strongest.
Note that the binding order is NOT the same as C, in some cases it is radically different (e.g. boolean math)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="union-and-union-all"></a>UNION and UNION ALL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#union-and-union-all" title="Direct link to heading">#</a></h4><p>These appear only in the context of <code>SELECT</code> statements.  The arms of a compound select may include <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>WINDOW</code>.  If <code>ORDER BY</code> or <code>LIMIT ... OFFSET</code> are present, these apply to the entire UNION.</p><p>example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>WHERE</code> applies only to the second select in the union.  And each <code>SELECT</code> is evaluated before the the <code>UNION ALL</code></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>ORDER BY</code> applies to the result of the union, so any results from the 2nd branch will sort before any results from the first branch (because <code>x</code> is constrained in both).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="assignment"></a>Assignment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#assignment" title="Direct link to heading">#</a></h4><p>Assignment only occurs in the <code>UPDATE</code> statement or in the <code>SET</code> statement.  In both cases the left side
is a simple target and the right side is a general expression.  The expression is evaluated before the assignment.</p><p>example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + before AND then :=</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logical-or"></a>Logical OR<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logical-or" title="Direct link to heading">#</a></h4><p>The logical <code>OR</code> operator does shortcut evaluation, much like the C <code>||</code> operator (not to be confused with SQL&#x27;s concatenation operator with the same lexeme).</p><p>The truth table for logical <code>OR</code> is as follows:</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">A OR B</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">0</td><td align="center">NULL</td><td align="center">NULL</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">NULL</td><td align="center">1</td></tr><tr><td align="center">NULL</td><td align="center">0</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">NULL</td><td align="center">NULL</td><td align="center">NULL</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logical-and"></a>Logical AND<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logical-and" title="Direct link to heading">#</a></h4><p>The logical <code>AND</code> operator does shortcut evaluation, much like the C <code>&amp;&amp;</code> operator, so if the left side is zero the result is 0 and the right side is not evaluated.</p><p>The truth table for logical <code>AND</code> is as follows:</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">A AND B</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">NULL</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">NULL</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">NULL</td><td align="center">1</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">NULL</td><td align="center">NULL</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="between-and-not-between"></a>BETWEEN and NOT BETWEEN<a aria-hidden="true" tabindex="-1" class="hash-link" href="#between-and-not-between" title="Direct link to heading">#</a></h4><p>These are a ternary type operation.  The general forms are:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  expr1 </span><span class="token operator" style="color:rgb(137, 221, 255)">BETWEEN</span><span class="token plain"> expr2 </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> expr3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  expr1 </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">BETWEEN</span><span class="token plain"> expr2 </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> expr3</span></div></div></div></div></div><p>Note that there is an inherent ambiguity in the language because <code>expr2</code> or <code>expr3</code> could be logical expressions that include <code>AND</code>. CQL resolves this ambiguity by insisting that <code>expr2</code> and <code>expr3</code> be &quot;math expressions&quot; in the grammar.</p><p>&quot;Math expressions&quot; consist of:</p><ul><li>bitwise <code>&amp;</code> and <code>|</code></li><li>bitwise left shift or right shift (<code>&lt;&lt;</code> and <code>&gt;&gt;</code>)</li><li>addition (<code>+</code>)</li><li>subtraction (<code>-</code>)</li><li>multiplication (<code>*</code>)</li><li>division (<code>/</code>)</li><li>modulus (<code>%</code>)</li><li>unary negation (<code>-</code>)</li><li>literals</li><li>any parenthesized expression</li></ul><p>Hence:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- oh hell no (syntax error)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all ok</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>These considerations force the grammar to contain special rules for expressions after <code>BETWEEN</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logical-not"></a>Logical NOT<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logical-not" title="Direct link to heading">#</a></h4><p>The one operand of logical not must be a numeric.  <code>NOT &#x27;x&#x27;</code> is illegal.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="non-ordering-tests-----like-glob-match-in-not-in-is-is-not"></a>Non-ordering tests <code>!=</code>, <code>&lt;&gt;</code>, <code>=</code>, <code>==</code>, <code>LIKE</code>, <code>GLOB</code>, <code>MATCH</code>, <code>IN</code>, <code>NOT IN</code>, <code>IS</code>, <code>IS NOT</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#non-ordering-tests-----like-glob-match-in-not-in-is-is-not" title="Direct link to heading">#</a></h4><p>These operations do some non-ordered comparison of their two operands.</p><ul><li><code>IS</code> and <code>IS NOT</code> never return <code>NULL</code>,  So for instance <code>X IS NOT NULL</code> gives the natural answer.  <code>x IS y</code> is true if and only if: 1. both <code>x</code> and <code>y</code> are <code>NULL</code> or 2. if they are equal.</li><li>The other operators return <code>NULL</code> if either operand is <code>NULL</code> and otherwise perform their usual test to produce a boolean</li><li><code>!=</code> and <code>&lt;&gt;</code> are equivalent as are <code>=</code> and <code>==</code></li><li>strings and blobs compare equal based on their value, not their identity (i.e. not the string/blob pointer)</li><li>objects compare equal based on their address, not their content (i.e. reference equality)</li><li><code>MATCH</code> and <code>GLOB</code> only valid in SQL contexts, <code>LIKE</code> can be used in any context (a helper method to do <code>LIKE</code> in C is provided by SQLite, but not the others)</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is also true because NULL == NULL is not 1, it&#x27;s NULL.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is also true because NULL != NULL is not 0, it&#x27;s also NULL.</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ordering-comparisons----"></a>Ordering comparisons &lt;, &gt;, &lt;=, &gt;=<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ordering-comparisons----" title="Direct link to heading">#</a></h4><p>These operators do the usual order comparison of their two operands.</p><ul><li>If either operand is <code>NULL</code> the result is <code>NULL</code></li><li>Objects and Blobs may not be compared with these operands</li><li>Strings are compared based on their value (as with other comparisons) not their address</li><li>Numerics are compared as usual with the usual promotion rules</li></ul><p>NOTE: CQL uses <code>strcmp</code> for string comparison. In SQL expressions the comparison happens in whatever way SQLite has been configured. Typically general purpose string comparison should be done with helper functions that deal with collation and other considerations.  This is a very complex topic and CQL is largely silent on it.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="bitwise-operators----"></a>Bitwise operators &lt;&lt;, &gt;&gt;, &amp;, |<a aria-hidden="true" tabindex="-1" class="hash-link" href="#bitwise-operators----" title="Direct link to heading">#</a></h4><p>These are the bit-manipulation operations.  Their binding strength is VERY different than C so beware.
And notably the <code>&amp;</code> operator has the same binding strength as the <code>|</code> operator so they bind left to right,
this is utterly unlike most systems.  Many parenthesis are likely to be needed to get the usual &quot;or of ands&quot; patterns codified correctly.  Likewise the shift operators <code>&lt;&lt;</code> and <code>&gt;&gt;</code> are the same strength as <code>&amp;</code> and <code>|</code> which is very atypical. Consider:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- probably doesn&#x27;t mean what you think (this is not ambigous, it&#x27;s well defined, but unlike C)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- means the same as the above</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- probably what you intended</span></div></div></div></div></div><p>Note that these operators only work on integer and long integer data.  If any operand is <code>NULL</code> the result is `NULL.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="addition-and-subtraction---"></a>Addition and Subtraction +, -<a aria-hidden="true" tabindex="-1" class="hash-link" href="#addition-and-subtraction---" title="Direct link to heading">#</a></h4><p>These operators do the typical math.  Note that there are no unsigned numerics so it&#x27;s always signed math that is happening here.</p><ul><li>operands are promoted to the &quot;biggest&quot; type involved as previously described (bool -&gt; int -&gt; long -&gt; real)</li><li>only numeric operands are legal (no adding strings)</li><li>if any operand is <code>NULL</code> the result is <code>NULL</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="multiplication-division-modulus---"></a>Multiplication, Division, Modulus *, /, %<a aria-hidden="true" tabindex="-1" class="hash-link" href="#multiplication-division-modulus---" title="Direct link to heading">#</a></h4><p>These operators do the typical math.  Note that there are no unsigned numerics so it&#x27;s always signed math that is happening here.</p><ul><li>operands are promoted to the &quot;biggest&quot; type as previously described (bool -&gt; int -&gt; long -&gt; real)</li><li>only numeric operands are legal (no multiplying strings)</li><li>if any operand is <code>NULL</code> the result is <code>NULL</code></li></ul><p>EXCEPTION: the <code>%</code> operator doesn&#x27;t make sense on real values, so real values produces an error.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="unary-operators---"></a>Unary operators -, ~<a aria-hidden="true" tabindex="-1" class="hash-link" href="#unary-operators---" title="Direct link to heading">#</a></h4><p>Unary negation (<code>-</code>) and bitwise invert (<code>~</code>) are the strongest binding operators.</p><ul><li>The <code>~</code> operator only works on integer types (not text, not real)</li><li>the usual promotion rules otherwise apply</li><li>if the operand is <code>NULL</code> the result is <code>NULL</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="case-expressions"></a>CASE Expressions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-expressions" title="Direct link to heading">#</a></h3><p>The <code>case</code> expression has two major forms and provides a great deal of flexibility in an expression.  You can kind of think of it as the C <code>?:</code> operator on steroids.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>In this form the expression in the case <code>x</code> here is evaluated exactly once and then compared against each <code>when</code> clause, they must be type compatible with the expression.  The <code>then</code> expression that corresponds is evaluated and becomes the result, or the <code>else</code> expression if present and no <code>when</code> matches.  If there is no else and no match the result is <code>null</code>.</p><p>If that&#x27;s not general enough, there is an alternate form:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;yy&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> z :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The second form, where there is no value before the first <code>when</code> keyword, each <code>when</code> expression is a separate independent boolean expression.  The first one that evaluates to true causes the corresponding <code>then</code> to be evaluated and that becomes the result.  If there are no matches the result is the <code>else</code> expression, or <code>null</code> if there is no <code>else</code>.</p><p>The result types must be compatible and the best type to hold the answer is selected with the usual promotion rules.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="select-expressions"></a>SELECT expressions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#select-expressions" title="Direct link to heading">#</a></h4><p>Single values can be extracted from SQLite using an inline <code>select</code> expression.  For instance:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The select statement in question must extract exactly one column and the type of the expression becomes the type of the column.  This form can appear
anywhere an expression can be appear, though it is most commonly used in assignments.  Something like this would also be valid:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The select statement can of course be arbitrarily complex.</p><p>Note, if the select statement returns no rows this will result in the normal error flow.  In that case, the error code will be SQLITE_DONE, which is treated like an
error because in this context SQLITE_ROW is expected as a result of the select.  This is not a typical error code can be quite surprising to callers.  If you&#x27;re
seeing this failure mode it usually means the code had no affordance for the case where there were no rows and probably that situation should have been handled.
This is an easy mistake to make, so to avoid it, CQL also supports these more tolerant forms:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>And even more generally if the schema allows for null vales and those are not desired:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Both of these are much safer to use as only genuine errors (e.g. the table was dropped and no longer exists) will result in the error control flow.</p><p>Again note that:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Would not avoid the SQLITE_DONE error code, because no rows returned is not at all the same as a null value returned.</p><p>The <code>if nothing or null</code> form above is equivalent to the following, but it is more economical, and probably clearer:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>To compute the type of the overall expression, the rules are almost the same as normal binary operators.  In particular:</p><ul><li>if the default expression is present it must be type compatible with the select result<ul><li>the result type is the smallest type that holds both the select value and the default expression (see normal promotion rules above)</li></ul></li><li>object types are not allowed (SQLite cannot return an object)</li><li>in <code>(select ...)</code> the result type is not null if and only if the select result type is not null (see select statement, many cases)</li><li>in <code>(select ... if nothing)</code> the result type is not null if and only if both the select result and the default expression types are not null (normal binary rules)</li><li>in <code>(select ... if nothing or null)</code> the result type is not null if and only if the default expression type is not null</li></ul><p>Finally, the form  <code>(select ... if nothing throw)</code> is allowed; this form is exactly the same as normal
<code>(select ...)</code> but makes the explicit that the error control flow will happen if there is no row.  Consequently
this form is allowed even if <code>@enforce_strict select if nothing</code> is in force.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="marking-data-as-sensitive"></a>Marking Data as Sensitive<a aria-hidden="true" tabindex="-1" class="hash-link" href="#marking-data-as-sensitive" title="Direct link to heading">#</a></h3><p>CQL supports the notion of &#x27;sensitive&#x27; data in a first class way.  You can think of it as very much like nullability;  It largely begins by tagging data columns with <code>@sensitive</code></p><p>Rather than go through the whole calculus, it&#x27;s easier to understand by a series of examples.  So let&#x27;s start with a table with some sensitive data.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The most obvious thing you might do at this point is create a stored proc that would read data out of that table.  Maybe something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> not_sensitive_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sens </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> sensitive_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;x&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> not_sensitive_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">sens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sens </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>So looking at that procedure we can see that it&#x27;s reading sensitive data, the result will have some sensitive columns in it.</p><ul><li>the &quot;id&quot; is not sensitive (at least not in this example)</li><li>sens + 1 is sensitive, math on a sensitive field leaves it sensitive</li><li>name is sensitive, it began that way and is unchanged</li><li>&#x27;x&#x27; is just a string literal, it&#x27;s not sensitive</li><li>-sens is sensitive, that&#x27;s more math</li><li>and the between expression is also sensitive</li></ul><p>Generally sensitivity is &quot;radioactive&quot; anything it touches becomes sensitive.  This is very important because even a simple looking expression like <code>lgbtqia IS NOT NULL</code> must lead to a sensitive result or the whole process would be largely useless.  It has to be basically impossible to wash away sensitivity.</p><p>These rules apply to normal expressions as well as expressions in the context of SQL.  Accordingly:</p><p>Sensitive variables can be declared:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Simple operations on the variables are sensitive</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is sensitive (and the same would be true for any other math)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>IN</code> expression gives you sensitive results if anything about it is sensitive</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Similarly sensitive constructs in <code>CASE</code> expressions result in a sensitive output</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- not sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Cast operations preserve sensitivity</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive result</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>Aggregate functions likewise preserve sensitivity</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">AVG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MAX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>There are many operators that get similar treatment such as <code>COALESCE</code>, <code>IFNULL</code>, <code>IS</code> and <code>IS NOT</code>.</p><p>Things get more interesting when we come to the <code>EXISTS</code> operator:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive if and only if any selected column is sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive because &quot;info&quot; is sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> info </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- not sensitive because &quot;id&quot; is not sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>If this is making you nervous, it probably should, we need a little more protection because of the way EXISTS is typically used.  The predicates matter, consider the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- id is now sensitive because the predicate of the where clause was sensitive</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this expression is now sensitive because id is sensitive in this context</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>In general: if the predicate of a <code>WHERE</code> or <code>HAVING</code> clause is sensitive then all columns in the result become sensitive.</p><p>Similarly when performing joins, if the column specified in the <code>USING</code> clause is sensitive or the predicate of the <code>ON</code> clause is sensitive then the result of the join is considered to be all sensitive columns (even if the columns were not sensitive in the schema).</p><p>Likewise a sensitive expression in <code>LIMIT</code> or <code>OFFSET</code> will result in 100% sensitive columns as these can be used in a <code>WHERE</code>-ish way.  There is no reasonble defense against using <code>LIMIT</code> and testing for the presence or absence of a row as a way to wash away sensitivity so that is a weakness, but the rules that are present are likely to be very helpful.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- join with ON</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1 </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> with_sensitive T2 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- join with USING</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1 </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> with_sensitive T2 </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>All of these expression and join propagations are designed to make it impossible to simply wash-away sensitivity with a little bit of math.</p><p>Now we come to enforcement, which boils down to what assignments or &quot;assignment-like&quot; operations we allow.</p><p>If we have these:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare sens integer @sensitive;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare not_sens integer;</span></div></div></div></div></div><p>We can use those as stand-ins for lots of expressions, but the essential calculus goes like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- assigning a sensitive to a sensitive is ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set sens := sens + 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- assigning not sensitive data to a sensitive is ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- this is needed so you can (e.g.) initialize to zero</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set sens := not_sens;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- not ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set not_sens := sens;</span></div></div></div></div></div><p>Now these &quot;assignments&quot; can happen in a variety of ways:</p><ul><li>you can set an out parameter of your procedure</li><li>when calling a function or procedure, we require:<ul><li>any IN parameters of the target be &quot;assignable&quot; from the value of the argument expression</li><li>any OUT parameters of the target be &quot;assignable&quot; from the procedures type to the argument variable</li><li>any IN/OUT parameters require both the above</li></ul></li></ul><p>Now it&#x27;s possible to write a procedure that accepts sensitive things and returns non-sensitive things.  This is fundamentally necessary because the proc must be able return (e.g.) a success code, or encrypted data, that is not sensitive.  However, if you write the procedure in CQL it, too, will have to follow the assignment rules and so cheating will be quite hard.  The idea here is to make it easy to do handle sensitive data well and make typical mistakes trigger errors.</p><p>With these rules  it&#x27;s possible to compute the the type of procedure result sets and also to enforce IN/OUT parameters.  Since the signature of procedures is conveniently generated with --generate_exports good practices are fairly easy to follow and sensitivity checks flow well into your programs.</p><p>This is a brief summary of CQL semantics for reference types -- those types that are ref counted by the runtime.</p><p>The three reference types are:</p><ul><li>TEXT</li><li>OBJECT</li><li>BLOB</li></ul><p>Each of these has their own macro for <code>retain</code> and <code>release</code> though all three actually turn into the exact same code in all the current CQL runtime implementations.  In all cases the object is expected to be promptly freed when the reference count falls to zero.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reference-semantics"></a>Reference Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reference-semantics" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="stored-procedure-arguments"></a>Stored Procedure Arguments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stored-procedure-arguments" title="Direct link to heading">#</a></h4><ul><li><code>in</code> and <code>inout</code> arguments are not retained on entry to a stored proc</li><li><code>out</code> arguments are assumed to contain garbage and are nulled without retaining on entry</li><li>if your <code>out</code> argument doesn&#x27;t have garbage in it, then it is up to you do <code>release</code> it before you make a call</li><li>When calling a proc with an <code>out</code> argument CQL will <code>release</code> the argument variable before the call site, obeying its own contract</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="local-variables"></a>Local Variables<a aria-hidden="true" tabindex="-1" class="hash-link" href="#local-variables" title="Direct link to heading">#</a></h4><ul><li>assigning to a local variable <code>retains</code> the object, and then does a <code>release</code> on the previous object</li><li>this order is important, all assignments are done in this way in case of aliasing (<code>release</code> first might accidentally free too soon)</li><li>CQL calls <code>release</code> on all local variable when the method exits</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="assigning-to-an-out-parameter-or-a-global-variable"></a>Assigning to an <code>out</code> parameter or a global variable<a aria-hidden="true" tabindex="-1" class="hash-link" href="#assigning-to-an-out-parameter-or-a-global-variable" title="Direct link to heading">#</a></h4><ul><li><code>out</code>, <code>inout</code> parameters, and global variables work just like local variables except that CQL does not call <code>release</code> at the end of the procedure</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="function-return-values"></a>Function Return Values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#function-return-values" title="Direct link to heading">#</a></h3><p>Stored procedures do not return values, they only have <code>out</code> arguments and those are well defined as above.  Functions however are also supported and they can have either <code>get</code> or <code>create</code> semantics</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="get-semantics"></a>Get Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-semantics" title="Direct link to heading">#</a></h4><p>If you declare a function like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare function Getter() object;</span></div></div></div></div></div><p>Then CQL assumes that the returned object should follow the normal rules above, retain/release will balance by the end of the procedure for locals and globals or <code>out</code> arguments could retain the object.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-semantics"></a>Create Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-semantics" title="Direct link to heading">#</a></h4><p>If you declare a function like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">declare function Getter() create text;</span></div></div></div></div></div><p>Then CQL assumes that the function created a new result which it is now responsible for releasing.  In short the returned object is assumed to arrive with a retain count of 1 already on it.  When CQL stores this return value it will:</p><ul><li>release the object that was present at the storage location (if any)</li><li>copy the returned pointer without further retaining it this one time</li></ul><p>As a result if you store the returned value in a local variable it will be released when the procedure exits (as usual) or if you instead store the result in a global or an out parameter the result will survive to be used later.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="comparison"></a>Comparison<a aria-hidden="true" tabindex="-1" class="hash-link" href="#comparison" title="Direct link to heading">#</a></h3><p>CQL tries to adhere to normal SQL comparison rules but with a C twist.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="object"></a><code>OBJECT</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#object" title="Direct link to heading">#</a></h3><p>The object type has no value based comparison, so there is no <code>&lt;</code>, <code>&gt;</code> and so forth.</p><p>The following table is useful.  Let&#x27;s suppose there are exactly two distinct objects &#x27;X&#x27; and &#x27;Y&#x27;</p><p>true expressions: <code>X = X</code>   <code>X &lt;&gt; Y</code> <code>Y = Y</code>   <code>Y &lt;&gt; X</code>  <code>X IN (X, Y)</code>  <code>X NOT IN (Y)</code></p><p>false expressions: <code>X = Y</code>  <code>X &lt;&gt; X</code> <code>Y = X</code>  <code>Y &lt;&gt; Y</code>  <code>X NOT IN (X, Y)</code></p><p>null expressions: <code>null = null</code>  <code> X &lt;&gt; null</code>   <code>x = null</code> <code>null &lt;&gt; null</code>  <code>Y &lt;&gt; null</code>   <code>y = null</code></p><p><code>null = null</code> resulting in <code>null</code> is particular surprising but consistent with the usual SQL rules.  And again, as in SQL, the <code>IS</code> operator returns true for <code>X IS Y</code> even if both are <code>null</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="text"></a><code>TEXT</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#text" title="Direct link to heading">#</a></h3><p>Text has value comparison semantics but normal string comparison is done only with <code>strcmp</code> which is of limited value.  Typically you&#x27;ll want to either delegate the comparison to Sqlite (with <code>(select x &lt; y)</code>) or else use a helper function with a suitable comparison mechanism.</p><p>For text comparisons including equality:</p><p>true:   if and only if both operands are not null and the comparison matches (using strcmp)
false:  if and only if  both operands are not null and the comparison does not match (using strcmp)
null:   if and only if at least one operand is null</p><p>EXAMPLE: <code>&#x27;x&#x27; &lt; &#x27;y&#x27;</code>  is true because <code>strcmp(&quot;x&quot;, &quot;y&quot;) &lt; 0</code></p><p>The <code>IS</code> and <code>IS NOT</code> operators behave similarly to equality and inequality, but never return <code>null</code>.  If <code>X</code> is some value that doesn&#x27;t happen to be <code>null</code> then we have the following:</p><p>true:  <code>null is null</code> <code>X is X</code> <code>X is not null</code> <code>null is not X</code>
false: <code>null is not null</code> <code>X is not X</code> <code>X is null</code> <code>null  is X</code></p><p>The <code>IN</code> and <code>NOT IN</code> operators also work for text using the same value comparisons as above.  Additionally there are special text comparison
operators such as <code>LIKE</code>, <code>MATCH</code> and <code>GLOB</code>.  These comparisons are defined by SQLite.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="blob"></a><code>BLOB</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#blob" title="Direct link to heading">#</a></h3><p>Blobs are compared by value (equivalent to <code>memcmp</code>) but have no well-defined ordering. The <code>memcmp</code> order is deemed not helpful as blobs
usually have internal structure hence the valid comparisons are only equality and inequality.
You can use user defined functions to do better comparisons of your particular blobs if needed.</p><p>The net comparison behavior is otherwise just like strings.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sample-code"></a>Sample Code<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sample-code" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="out-argument-semantics"></a>Out Argument Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#out-argument-semantics" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE FUNCTION foo() OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROC foo_user (OUT baz OBJECT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET baz := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void foo_user(cql_object_ref _Nullable *_Nonnull baz) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  *(void **)baz = NULL; // set out arg to non-garbage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_set_object_ref(baz, foo());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="function-with-create-semantics"></a>Function with Create Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#function-with-create-semantics" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE FUNCTION foo() CREATE OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROCEDURE foo_user (INOUT baz OBJECT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DECLARE x OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET x := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET baz := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void foo_user(cql_object_ref _Nullable *_Nonnull baz) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref x = NULL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(x);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  x = foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(*baz);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  *baz = foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_cleanup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(x);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="function-with-get-semantics"></a>Function with Get Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#function-with-get-semantics" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE FUNCTION foo() OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROCEDURE foo_user (INOUT baz OBJECT)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DECLARE x OBJECT;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET x := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET baz := foo();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">void foo_user(cql_object_ref _Nullable *_Nonnull baz) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref x = NULL;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_set_object_ref(&amp;x, foo());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_set_object_ref(baz, foo());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cql_cleanup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_release(x);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-07-01T12:24:29.000Z" class="docLastUpdatedAt_217_">7/1/2021</time> by <strong>mingodad</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cql-guide/ch02"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Chapter 2: Using Data</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cql-guide/ch04"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Chapter 4: Procedures, Functions, and Control Flow Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#expression-examples" class="table-of-contents__link">Expression Examples</a></li><li><a href="#order-of-evaluation" class="table-of-contents__link">Order of Evaluation</a></li><li><a href="#variables-columns-basic-types-and-nullability" class="table-of-contents__link">Variables, Columns, Basic Types and Nullability</a></li><li><a href="#types-of-literals" class="table-of-contents__link">Types of Literals</a></li><li><a href="#const-and-enumerations" class="table-of-contents__link">Const and Enumerations</a></li><li><a href="#named-types" class="table-of-contents__link">Named Types</a></li><li><a href="#type-kinds" class="table-of-contents__link">Type Kinds</a></li><li><a href="#nullability" class="table-of-contents__link">Nullability</a></li><li><a href="#expression-types" class="table-of-contents__link">Expression Types</a></li><li><a href="#case-expressions" class="table-of-contents__link">CASE Expressions</a></li><li><a href="#marking-data-as-sensitive" class="table-of-contents__link">Marking Data as Sensitive</a></li><li><a href="#reference-semantics" class="table-of-contents__link">Reference Semantics</a></li><li><a href="#function-return-values" class="table-of-contents__link">Function Return Values</a></li><li><a href="#comparison" class="table-of-contents__link">Comparison</a></li><li><a href="#object" class="table-of-contents__link"><code>OBJECT</code></a></li><li><a href="#text" class="table-of-contents__link"><code>TEXT</code></a></li><li><a href="#blob" class="table-of-contents__link"><code>BLOB</code></a></li><li><a href="#sample-code" class="table-of-contents__link">Sample Code</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.youtube.com/channel/UC2lTapw2Um90sZpGQVaynEg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Facebook Open Source Logo" src="/img/oss_logo.png"></a></div><div>Copyright Â© 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.480d1f30.js"></script>
<script src="/runtime~main.34082030.js"></script>
<script src="/main.b815b31d.js"></script>
<script src="/1.2e95473d.js"></script>
<script src="/2.0c45b020.js"></script>
<script src="/3.d04889a6.js"></script>
<script src="/1be78505.d00e88e1.js"></script>
<script src="/82.ac17f5fe.js"></script>
<script src="/5456faf3.a2899e62.js"></script>
<script src="/17896441.ea9e5e3f.js"></script>
<script src="/8982177e.8b72bbe3.js"></script>
</body>
</html>